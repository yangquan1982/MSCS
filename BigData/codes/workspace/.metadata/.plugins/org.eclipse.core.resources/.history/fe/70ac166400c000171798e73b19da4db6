package lab4.q1;

import java.io.BufferedReader;
import java.io.FileReader;
import java.nio.file.Path;
import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

public class Mapper {

	@SuppressWarnings("unchecked")
	private <T> ArrayList<T> getWords(T SInput){
		if (SInput==null) {
			return null;
		}
	    ArrayList<T> allWordsList = new ArrayList<T>();
	    String[] strArray = ((String) SInput).split("\\s|-");
	    String SWord = "";
	    for(int i=0; i<strArray.length; i++){
	    	for(int j=0;j<strArray[i].length();j++){
		        Character charAt = strArray[i].charAt(j);
		        if(Character.isDigit(charAt)
		        		|| (charAt.equals('.') && j<strArray[i].length()-1)
		        		|| charAt.equals('_')){
		        	SWord = "";
		        	break;
		        }
		        if(charAt.equals(',')
		        		|| charAt.equals('"')
		        		|| charAt.equals('\'')
		        		|| charAt.equals('.')){
		        	continue;
		        }
	            SWord += charAt;
	    	}
	    	if(SWord!=""){
	        	String keyWord = new String(SWord);
	        	allWordsList.add((T) keyWord.toLowerCase());
	        	SWord = "";
	    	}
	    }
	    return allWordsList;
	}
	private List<Pair> mapOutput(List<Pair> pairList){
		if(pairList==null){
			return null;
		}
		Collections.sort(pairList, (p1,p2) -> p1.getKey().compareTo(p2.getKey()));
		List<Pair> mapOutputList = new ArrayList<>();
		Pair p0 = pairList.get(0);
		mapOutputList.add(p0);
		for(int i=1;i<pairList.size();i++){
			Pair p = pairList.get(i);
			Pair lastP = mapOutputList.get(mapOutputList.size()-1);
			if(lastP.getKey()==p.getKey()){
				int value = lastP.getValue();
				lastP.setValue(value++);
			} else{
				mapOutputList.add(new Pair(p.getKey(),1));
			}
		}
		
		return mapOutputList;
	}
	@SuppressWarnings({ "unchecked", "resource" })
	public <T> List<T> map(Path filePath){
		if (filePath==null) {
			return null;
		}
		BufferedReader br = null;
		List<Pair> pairList = null;
		List<Pair> mapOutput = null;
		try (FileReader fr = new FileReader(filePath.toString())){
			br = new BufferedReader(fr);
			String sCurrentLine;
			ArrayList<String> allWordsList = null;
			pairList = new ArrayList<>();
			String strText = "";
			while((sCurrentLine = br.readLine()) != null){
				strText += sCurrentLine + " ";
			}
			allWordsList = getWords(strText);
			for(String word:allWordsList){
				pairList.add(new Pair(word,1));
			}
			mapOutput = mapOutput(pairList);
		} catch (Exception e) {
			e.printStackTrace();
		} 
		return (List<T>) pairList;
	}
}
